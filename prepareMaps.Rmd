---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r}
rm(list = ls())

gasandschool="https://github.com/Spatial-Data-Analytics-DACSS-690D/Gas-Station-Relocation-Analysis/raw/refs/heads/main/python/dashboard.gpkg"
library(sf)
st_layers(gasandschool)
```
## Reading the layers:

```{r, message=FALSE}
boston <- st_read(gasandschool, layer = "boston")
stations <- st_read(gasandschool, layer = "stations")
fuelBoston <- st_read(gasandschool, layer = "fuelBoston")
schoolBoston <- st_read(gasandschool, layer = "schoolBoston")
secured_schoolBoston <- st_read(gasandschool, layer = "secured_schoolBoston")
fuelBoston_allPoly <- st_read(gasandschool, layer = "fuelBoston_allPoly")
gas_relocate <- st_read(gasandschool, layer = "gas_relocate")
suitable_roads <- st_read(gasandschool, layer = "suitable_roads")
streets <- st_read(gasandschool, layer = "streets")
secured_fuelBoston_allPoly <- st_read(gasandschool, layer = "secured_fuelBoston_allPoly")
good_routes_forGas <- st_read(gasandschool, layer = "good_routes_forGas")
GoodLocationsGas_buffered_gdf <- st_read(gasandschool, layer = "GoodLocationsGas_buffered_gdf")
GoodLocationsGas_gdf <- st_read(gasandschool, layer = "GoodLocationsGas_gdf")
GoodLocationsGas_4326 <- st_read(gasandschool, layer = "GoodLocationsGas_4326")
```

```{r}
library(ggplot2)
library(scales)
library(dplyr)
```


```{r}
library(ggplot2)
library(sf)

plot_1 <- ggplot() +
  geom_sf(data = boston, aes(color = "Boston Boundary"), fill = "lightblue", size = 0.5) +
  geom_sf(data = schoolBoston, aes(color = "School"), size = 2) +
  geom_sf(data = fuelBoston, aes(color = "Gas Station"), size = 2) +
  scale_color_manual(
    name = "Legend",
    values = c(
      "Boston Boundary" = "lightblue",
      "School" = "black",
      "Gas Station" = "red"
    )
  ) +
  labs(
    title = "Gas Stations and Schools in Boston",
    subtitle = "Visualization of gas stations and schools within Boston city limits",
    x = "Longitude", y = "Latitude"
  ) +
  theme_bw() +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.title = element_text(face = "bold")
  )

saveRDS(plot_1, file = "plot1.rds")
plot_1

```




```{r}
plot_2 <- ggplot() +
  geom_sf(data = secured_schoolBoston, aes(fill = "School Safety Zone"), color = NA, alpha = 0.6) +
  geom_sf(data = gas_relocate, aes(color = "Gas Station (to Relocate)"), size = 1.5) +
  scale_fill_manual(name = "Legend", values = c("School Safety Zone" = "yellow")) +
  scale_color_manual(name = "Legend", values = c("Gas Station (to Relocate)" = "red")) +
  labs(
    title = "Gas Stations Near Schools (Within 200 m)",
    subtitle = "Stations intersecting school safety zones, requiring relocation",
    x = "Longitude", y = "Latitude"
  ) +
  theme_bw() +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.title = element_text(face = "bold")
  )

saveRDS(plot_2, file = "plot2.rds")
plot_2

```


```{r}
plot_3 <- ggplot() +
  geom_sf(data = good_routes_forGas, aes(color = "Potential Route"), size = 0.8) +
  scale_color_manual(
    name = "Legend",
    values = c("Potential Route" = "darkgreen")
  ) +
  labs(
    title = "Potential Road Network for Gas Station Relocation",
    subtitle = "Identified routes suitable for relocation based on accessibility and safety",
    x = "Longitude", y = "Latitude"
  ) +
  theme_bw() +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.title = element_text(face = "bold")
  )

saveRDS(plot_3, file = "plot3.rds")
plot_3

```


```{r}
intersection_data <- tryCatch({
  st_intersection(fuelBoston, gas_relocate)
}, error = function(e) {
  message("⚠️ Intersection failed, skipping magenta layer.")
  NULL
})

plot_4 <- ggplot() +
  geom_sf(data = suitable_roads, aes(fill = "Suitable Roads"), color = "goldenrod", size = 0.5) +
  geom_sf(data = GoodLocationsGas_buffered_gdf, aes(color = "Relocation Buffers"), fill = NA, size = 1) +
  geom_sf(data = GoodLocationsGas_gdf, aes(shape = "Candidate Centers"), color = "red", size = 3) +
  geom_sf(data = fuelBoston, aes(color = "Existing Gas Stations"), size = 1.2) +
  geom_sf(data = schoolBoston, aes(color = "Schools"), size = 1.2) +
  { if (!is.null(intersection_data)) geom_sf(data = intersection_data, aes(color = "Stations to Relocate"), size = 2) } +
  scale_fill_manual(name = "Legend", values = c("Suitable Roads" = "yellow")) +
  scale_color_manual(
    name = "Legend",
    values = c(
      "Relocation Buffers" = "red",
      "Existing Gas Stations" = "black",
      "Schools" = "green",
      "Stations to Relocate" = "magenta"
    )
  ) +
  scale_shape_manual(
    name = "Legend",
    values = c("Candidate Centers" = 3)
  ) +
  labs(
    title = "Suitable Roads and Proposed Gas Station Relocation Sites",
    subtitle = "Visualizing candidate relocation buffers and existing gas/school locations",
    x = "Longitude", y = "Latitude"
  ) +
  theme_bw() +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.title = element_text(face = "bold")
  )

saveRDS(plot_4, file = "plot4.rds")
plot_4

```

